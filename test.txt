#include <Arduino.h>
#include <U8g2lib.h>
#include <Wire.h>

// --- INCLUDE FILE VIDEO CỦA BẠN ---
#include "video.h" 

// --- CẤU HÌNH OLED SH1106 ---
// SCL = 9, SDA = 8 (C3 Super Mini)
U8G2_SH1106_128X64_NONAME_F_HW_I2C u8g2(U8G2_R0, /* reset=*/ U8X8_PIN_NONE, /* clock=*/ 9, /* data=*/ 8);

// Biến đếm frame
int currentFrame = 0;
unsigned long lastFrameTime = 0;
int frameDelay = 40; // Tốc độ video (40ms ~ 25 FPS)

void setup() {
  // Khởi động màn hình
  u8g2.begin();
  u8g2.setContrast(255); // Độ sáng tối đa
}

void loop() {
  // Kiểm tra thời gian (Non-blocking)
  if (millis() - lastFrameTime > frameDelay) {
    lastFrameTime = millis();

    u8g2.clearBuffer(); // 1. Xóa bộ nhớ đệm
    
    // 2. Vẽ ảnh Bitmap
    // Lưu ý: Code này dùng tên biến "epd_bitmap_allArray" từ file video.h của bạn
    // 128, 64 là kích thước ảnh.
// 16 ở đây là số Byte chiều ngang (128 pixel / 8 bit = 16 byte)
u8g2.drawBitmap(0, 0, 16, 64, epd_bitmap_allArray[currentFrame]);    
    u8g2.sendBuffer();  // 3. Đẩy ra màn hình

    // 4. Tăng frame
    currentFrame++;
    
    // Dùng biến "epd_bitmap_allArray_LEN" có sẵn trong file của bạn để biết khi nào hết phim
    if (currentFrame >= epd_bitmap_allArray_LEN) {
      currentFrame = 0; // Quay lại đầu
    }
  }
}